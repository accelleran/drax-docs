
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://accelleran.github.io/drax-docs-2022-3-1/benetel650-install/">
      
      <link rel="icon" href="../images/accelleran_favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.0">
    
    
      
        <title>Summary - dRAX - 2022.3.1 release</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.fe914879.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ba0d045b.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#summary" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="dRAX - 2022.3.1 release" class="md-header__button md-logo" aria-label="dRAX - 2022.3.1 release" data-md-component="logo">
      
  <img src="../images/accelleran_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            dRAX - 2022.3.1 release
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Summary
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Accelleran CU Install Guide
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../kubernetes-install/" class="md-tabs__link">
      CU installation ( VM & kubernetes )
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../drax-install/" class="md-tabs__link">
      RIC & CU Installation
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../du-install/" class="md-tabs__link">
      DU Installation
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../core-install/" class="md-tabs__link">
      Core Installation
    </a>
  </li>

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="dRAX - 2022.3.1 release" class="md-nav__button md-logo" aria-label="dRAX - 2022.3.1 release" data-md-component="logo">
      
  <img src="../images/accelleran_logo.png" alt="logo">

    </a>
    dRAX - 2022.3.1 release
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Accelleran CU Install Guide
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes-install/" class="md-nav__link">
        CU installation ( VM & kubernetes )
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../drax-install/" class="md-nav__link">
        RIC & CU Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../du-install/" class="md-nav__link">
        DU Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../core-install/" class="md-nav__link">
        Core Installation
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h1>
<h2 id="drawing">Drawing<a class="headerlink" href="#drawing" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>  10.10.0.100:ssh
  +-------------+
  |             |
  |             |             +-----------+         +-----------+
  |             |             |           |         |           |
  |     RRU     +----fiber----+   L1      |         |    DU     |
  |             |             |           |         |           |
  |             |             +-----------+         +-----------+
  |             |
  +-------------+
aa:bb:cc:dd:ee:ff              11:22:33:44:55:66

  10.10.0.2:44000              10.10.0.1:44000

             eth0              enp45s0f0

      port FIBER1
</code></pre></div>
<h2 id="configure-the-du-under-construction">Configure the DU ( under construction )<a class="headerlink" href="#configure-the-du-under-construction" title="Permanent link">&para;</a></h2>
<p>This chapter on only focuses on what to configure to get the Benetel650 working. 
 The complete installation of the DU can be found in the du-install doc itself.
Other then the B210, benetel uses 2 software components. 2 Containers, a effnet du and phluido l1.
The phluido rru is not needed. This component resides in the benetel equipment.</p>
<p>adapt the <code>PhluidoL1_NR_Benetel.cfg</code> file delivered by effnet
Make sure to set the value <code>LicenseKey</code> option to the received Phluido license key:</p>
<div class="highlight"><pre><span></span><code>to be tested which .cfg to use
</code></pre></div>
<p>Create a configuration file for the Effnet DU:</p>
<div class="highlight"><pre><span></span><code>to be tested which .json to use
</code></pre></div>
<p>Before creating the <code>docker-compose.yml</code> file, make sure to set the <code>$CU_IP</code> environment variable.
This IP address can be determined by executing the following command.
The CU address is the second IP address.
This IP address should be in the IP pool that was assigned to MetalLB in <a href="/drax-docs/drax-install/">dRax Installation</a>.</p>
<div class="highlight"><pre><span></span><code>kubectl get services <span class="p">|</span> grep <span class="s1">&#39;acc-5g-cu-cp-.*-sctp-f1&#39;</span>
</code></pre></div>
<p>Now, create a docker-compose configuration file:</p>
<div class="highlight"><pre><span></span><code>tee accelleran-du-phluido/accelleran-du-phluido-2021-06-30/docker-compose.yml <span class="s">&lt;&lt;EOF</span>
<span class="s">version: &quot;3&quot;</span>

<span class="s">services:</span>

<span class="s">  phluido_l1:</span>
<span class="s">    image: phluido_l1</span>
<span class="s">    container_name: phluido_l1_cn</span>
<span class="s">    tty: true</span>
<span class="s">    privileged: true</span>
<span class="s">    ipc: shareable</span>
<span class="s">    shm_size: 2gb</span>
<span class="s">    command: /config.cfg</span>
<span class="s">    volumes:</span>
<span class="s">      - &quot;$PWD/phluido/PhluidoL1_NR_B210.cfg:/config.cfg:ro&quot;</span>
<span class="s">      - &quot;/run/logs-du/l1:/workdir&quot;</span>
<span class="s">      - &quot;/etc/machine-id:/etc/machine-id:ro&quot;</span>
<span class="s">    working_dir: &quot;/workdir&quot;</span>
<span class="s">    network_mode: host</span>

<span class="s">  du:</span>
<span class="s">    image: gnb_du_main_phluido</span>
<span class="s">    volumes:</span>
<span class="s">      - &quot;$PWD/b210_config_20mhz.json:/config.json:ro&quot;</span>
<span class="s">      - &quot;/run/logs-du/du:/workdir&quot;</span>
<span class="s">      - /run/pcscd/pcscd.comm:/run/pcscd/pcscd.comm</span>
<span class="s">    ipc: container:phluido_l1_cn</span>
<span class="s">    tty: true</span>
<span class="s">    cap_add:</span>
<span class="s">      - CAP_SYS_NICE</span>
<span class="s">      - CAP_IPC_LOCK</span>
<span class="s">    depends_on:</span>
<span class="s">      - phluido_l1</span>
<span class="s">    entrypoint: [&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;sleep 4 &amp;&amp; exec /gnb_du_main_phluido /config.json&quot;]</span>
<span class="s">    working_dir: &quot;/workdir&quot;</span>
<span class="s">    extra_hosts:</span>
<span class="s">      - &quot;cu:$F1_CU_IP&quot;</span>

<span class="s">EOF</span>
</code></pre></div>
<h2 id="prepare-the-server-for-the-benetel-650">Prepare the server for the Benetel 650<a class="headerlink" href="#prepare-the-server-for-the-benetel-650" title="Permanent link">&para;</a></h2>
<p>The benetel is connected with a fiber to the server. 
1. The port on the RRU is labeled <code>port FIBER1</code>
2. The port on the server is one of these listed below.</p>
<div class="highlight"><pre><span></span><code>:ad@5GCN:~$ lshw <span class="p">|</span> grep SFP -C <span class="m">5</span>
WARNING: you should run this program as super-user.
             capabilities: pci normal_decode bus_master cap_list
             configuration: <span class="nv">driver</span><span class="o">=</span>pcieport
             resources: irq:29 ioport:f000<span class="o">(</span><span class="nv">size</span><span class="o">=</span><span class="m">4096</span><span class="o">)</span> memory:f8000000-f86fffff
           *-network:0 DISABLED
                description: Ethernet interface
                product: 82599ES <span class="m">10</span>-Gigabit SFI/SFP+ Network Connection
                vendor: Intel Corporation
                physical id: <span class="m">0</span>
                bus info: pci@0000:2d:00.0
                logical name: enp45s0f0
                version: <span class="m">01</span>
--
                capabilities: bus_master cap_list rom ethernet physical fibre 10000bt-fd
                configuration: <span class="nv">autonegotiation</span><span class="o">=</span>off <span class="nv">broadcast</span><span class="o">=</span>yes <span class="nv">driver</span><span class="o">=</span>ixgbe <span class="nv">driverversion</span><span class="o">=</span><span class="m">5</span>.1.0-k <span class="nv">firmware</span><span class="o">=</span>0x2b2c0001 <span class="nv">latency</span><span class="o">=</span><span class="m">0</span> <span class="nv">link</span><span class="o">=</span>no <span class="nv">multicast</span><span class="o">=</span>yes
                resources: irq:202 memory:f8000000-f807ffff ioport:f020<span class="o">(</span><span class="nv">size</span><span class="o">=</span><span class="m">32</span><span class="o">)</span> memory:f8200000-f8203fff memory:f8080000-f80fffff memory:f8204000-f8303fff memory:f8304000-f8403fff
           *-network:1 DISABLED
                description: Ethernet interface
                product: 82599ES <span class="m">10</span>-Gigabit SFI/SFP+ Network Connection
                vendor: Intel Corporation
                physical id: <span class="m">0</span>.1
                bus info: pci@0000:2d:00.1
                logical name: enp45s0f1
                version: <span class="m">01</span>
</code></pre></div>
<p>by setting both network devices to UP you find out which one is connected.
In our case its enp45s0f0. This port is the one we connected the fiber with.</p>
<div class="highlight"><pre><span></span><code>:ad@5GCN:~$ sudo ip link <span class="nb">set</span> dev enp45s0f0 up
:ad@5GCN:~$ sudo ip link <span class="nb">set</span> dev enp45s0f1 up
:ad@5GCN:~$ ip -br a
    :
enp45s0f0        UP             fe80::6eb3:11ff:fe08:a4e0/64 
enp45s0f1        DOWN           
    :
</code></pre></div>
<p>configuring the static ip of enp45s0f0 is done via netplan.
add this part to <code>/etc/netplan/50-cloud-init.yaml</code> . 
In some installation it might be anot </p>
<div class="highlight"><pre><span></span><code>network:
    ethernets:
       enp45s0f0:
          dhcp4: <span class="nb">false</span>
          dhcp6: <span class="nb">false</span>
          optional: <span class="nb">true</span>
          addresses:
              - <span class="m">10</span>.10.0.1/24
          mtu: <span class="m">9000</span>
</code></pre></div>
<p>To apply this configuration you can use</p>
<div class="highlight"><pre><span></span><code>sudo netplan apply 
</code></pre></div>
<p>This needs to be the result</p>
<div class="highlight"><pre><span></span><code>$ ip -br a <span class="p">|</span> grep enp45
enp45s0f0        UP             <span class="m">10</span>.10.0.1/24 fe80::6eb3:11ff:fe08:a4e0/64 
enp45s0f1        DOWN           
</code></pre></div>
<p>The ip benetel is configured with is <code>10.10.0.100</code>. This is the MGMT ip. We can ssh to it.
We found out using nmap this way.</p>
<div class="highlight"><pre><span></span><code>$ nmap <span class="m">10</span>.10.0.0/24

Starting Nmap <span class="m">7</span>.60 <span class="o">(</span> https://nmap.org <span class="o">)</span> at <span class="m">2021</span>-09-21 <span class="m">10</span>:15 CEST
Nmap scan report <span class="k">for</span> <span class="m">10</span>.10.0.1
Host is up <span class="o">(</span><span class="m">0</span>.000040s latency<span class="o">)</span>.
Not shown: <span class="m">996</span> closed ports
PORT     STATE SERVICE
<span class="m">22</span>/tcp   open  ssh
<span class="m">111</span>/tcp  open  rpcbind
<span class="m">5900</span>/tcp open  vnc
<span class="m">9100</span>/tcp open  jetdirect

Nmap scan report <span class="k">for</span> <span class="m">10</span>.10.0.100
Host is up <span class="o">(</span><span class="m">0</span>.0053s latency<span class="o">)</span>.
Not shown: <span class="m">998</span> closed ports
PORT    STATE SERVICE
<span class="m">22</span>/tcp  open  ssh
<span class="m">111</span>/tcp open  rpcbind

Nmap <span class="k">done</span>: <span class="m">256</span> IP addresses <span class="o">(</span><span class="m">2</span> hosts up<span class="o">)</span> scanned <span class="k">in</span> <span class="m">3</span>.10 seconds
</code></pre></div>
<p>A route is added also in the route table automatically</p>
<div class="highlight"><pre><span></span><code>$ route -n <span class="p">|</span> grep <span class="m">10</span>.10.0.0
<span class="m">10</span>.10.0.0       <span class="m">0</span>.0.0.0         <span class="m">255</span>.255.255.0   U     <span class="m">0</span>      <span class="m">0</span>        <span class="m">0</span> enp45s0f0
<span class="sb">````</span>

now you can ssh to the benetel

<span class="sb">```</span> bash
$ ssh root@10.10.0.100

Last login: Fri Feb  <span class="m">7</span> <span class="m">16</span>:45:59 <span class="m">2020</span> from <span class="m">10</span>.10.0.1
root@benetelru:~# ls -l
-rwxrwxrwx    <span class="m">1</span> root     root          <span class="m">1572</span> Sep <span class="m">10</span>  <span class="m">2021</span> DPLL3_1PPS_REGISTER_PATCH.txt
drwxrwxrwx    <span class="m">2</span> root     root             <span class="m">0</span> Feb  <span class="m">7</span> <span class="m">16</span>:44 adrv9025
-rwxrwxrwx    <span class="m">1</span> root     root          <span class="m">1444</span> Feb  <span class="m">7</span> <span class="m">16</span>:40 dev_struct.dat
-rwxrwxrwx    <span class="m">1</span> root     root         <span class="m">17370</span> Sep <span class="m">10</span>  <span class="m">2021</span> dpdModelReadback.txt
-rwxrwxrwx    <span class="m">1</span> root     root          <span class="m">5070</span> Feb  <span class="m">7</span> <span class="m">17</span>:00 dpdModelcoefficients.txt
-rwxrwxrwx    <span class="m">1</span> root     root         <span class="m">24036</span> Sep <span class="m">10</span>  <span class="m">2021</span> eeprog_cp60
-rwxrwxrwx    <span class="m">1</span> root     root       <span class="m">1825062</span> Feb  <span class="m">7</span> <span class="m">15</span>:58 madura_log_file.txt
-rw-------    <span class="m">1</span> root     root          <span class="m">1230</span> Feb  <span class="m">7</span>  <span class="m">2020</span> nohup.out
-rwxr-xr-x    <span class="m">1</span> root     root            <span class="m">57</span> Feb  <span class="m">7</span>  <span class="m">2020</span> nohup_handshake
-rwxrwxrwx    <span class="m">1</span> root     root           <span class="m">571</span> Feb  <span class="m">7</span>  <span class="m">2020</span> progBenetelDuMAC_CATB
-rwxr-xr-x    <span class="m">1</span> root     root       <span class="m">1121056</span> Feb  <span class="m">7</span> <span class="m">16</span>:24 quickRadioControl
-rwxrwxrwx    <span class="m">1</span> root     root       <span class="m">1151488</span> Sep <span class="m">10</span>  <span class="m">2021</span> radiocontrol_prv-nk-cliupdate
-rwxrwxrwx    <span class="m">1</span> root     root         <span class="m">22904</span> Aug <span class="m">24</span>  <span class="m">2021</span> registercontrol
-rwxrwxrwx    <span class="m">1</span> root     root           <span class="m">164</span> Feb  <span class="m">7</span> <span class="m">16</span>:35 removeResetRU_CATB
-rwxrwxrwx    <span class="m">1</span> root     root           <span class="m">163</span> Feb  <span class="m">7</span>  <span class="m">2020</span> reportRuStatus
-rwxrwxrwx    <span class="m">1</span> root     root           <span class="m">162</span> Feb  <span class="m">7</span> <span class="m">16</span>:35 resetRU_CATB
-rwxr-xr-x    <span class="m">1</span> root     root            <span class="m">48</span> Feb  <span class="m">7</span> <span class="m">15</span>:57 runSync
-rwxrwxrwx    <span class="m">1</span> root     root         <span class="m">21848</span> Sep <span class="m">10</span>  <span class="m">2021</span> smuconfig
-rwxrwxrwx    <span class="m">1</span> root     root         <span class="m">17516</span> Sep <span class="m">10</span>  <span class="m">2021</span> statmon
-rwxrwxrwx    <span class="m">1</span> root     root         <span class="m">23248</span> Sep <span class="m">10</span>  <span class="m">2021</span> syncmon
-rwxr-xr-x    <span class="m">1</span> root     root           <span class="m">182</span> Feb  <span class="m">7</span> <span class="m">16</span>:41 trialHandshake
root@benetelru:~# 
</code></pre></div>
<p>The mac address of the benetel data interface can be found like this</p>
<div class="highlight"><pre><span></span><code>to be done
</code></pre></div>
<p>Add mac entry script in routable.d. </p>
<div class="highlight"><pre><span></span><code>$ cat /etc/networkd-dispatcher/routable.d/macs.sh 
#!/bin/sh
sudo arp -s 10.10.0.2 aa:bb:cc:dd:ee:ff -i enp45s0f0
chmod 777 /etc/networkd-dispatcher/routable.d/macs.sh
</code></pre></div>
<blockquote>
<p>Benetel650 does not answer arp requests. With this apr entry in the arp table the server knows to which mac address it needs to sent the ip packet to. The ip packet towards the RRU with ip 10.10.0.2.
</p>
</blockquote>
<p>Test the script by running it and checking the arp -a table like this</p>
<div class="highlight"><pre><span></span><code>$ arp -a | grep 10.10.0.2
? (10.10.0.2) at 02:00:5e:01:01:01 [ether] PERM on enp45s0f0
</code></pre></div>
<h2 id="version-check">Version Check<a class="headerlink" href="#version-check" title="Permanent link">&para;</a></h2>
<p>finding out the version and commit hash of the benetel650</p>
<p>commit hash
<div class="highlight"><pre><span></span><code>root@benetelru:~# registercontrol -v
Lightweight HPS-to-FPGA Control Program Version : V1.2.0

****BENETEL PRODUCT VERSIONING BLOCK****
This Build Was Created Locally. Please Use Git Pipeline!
Project ID NUMBER:  0
Git # Number:       f6366d7adf84933ab2b242a345bd63c07fedb9e5
Build ID:       0
Version Number:     0.0.1
Build Date:         2/12/2021
Build Time H:M:S:   18:20:3
****BENETEL PRODUCT VERSIONING BLOCK END****
</code></pre></div>
The version which is referred to. This is version 0.4. 
Depending on the version different configuration commands apply.
<div class="highlight"><pre><span></span><code>root@benetelru:~# cat /etc/benetel-rootfs-version 
RAN650-2V0.4
</code></pre></div></p>
<h2 id="configure-the-rru-release-v03">Configure the RRU release V0.3<a class="headerlink" href="#configure-the-rru-release-v03" title="Permanent link">&para;</a></h2>
<h3 id="set-du-mac-address-for-version-v03">Set DU mac address for version V0.3<a class="headerlink" href="#set-du-mac-address-for-version-v03" title="Permanent link">&para;</a></h3>
<p>Inside the file <code>/etc/radio_init.sh</code> we program the mac. </p>
<p>Example for MAC address 00:1E:67:FD:F5:51 you will find in the file:</p>
<div class="highlight"><pre><span></span><code>registercontrol -w c0315 -x 0x67FDF551 &gt;&gt; /home/root/radio_boot_response 
registercontrol -w c0316 -x 0x001E &gt;&gt; /home/root/radio_boot_response
echo &quot;Configure the MAC address of the O-DU: 00:1E:67:FD:F5:51 &quot; &gt;&gt; /home/root/radio_status
</code></pre></div>
<p>Make sure to edit those as MAC address of the fiber port.</p>
<p>Reboot the BNTL650</p>
<p>It is possible to run the commands manually to speed up things.</p>
<div class="highlight"><pre><span></span><code>registercontrol -w c0315 -x 0x67FDF551 &gt;&gt; /home/root/radio_boot_response 
registercontrol -w c0316 -x 0x001E &gt;&gt; /home/root/radio_boot_response
</code></pre></div>
<h3 id="set-the-frequency-for-version-v03">Set the Frequency for version V0.3<a class="headerlink" href="#set-the-frequency-for-version-v03" title="Permanent link">&para;</a></h3>
<p>This file <code>/etc/systemd/system/multi-user.target.wants/autoconfig.service</code> is called during boot that sets the frequency.
change the frequency here.</p>
<div class="highlight"><pre><span></span><code>[Service]
ExecStart =/bin/sh /etc/radio_init.sh 3751.680
</code></pre></div>
<p>Example for frequency 3751.68MHz (ARFCN=650112) you will find in the file:
Make sure to edit the pointA frequency ARFCN value in the DU config (in this example PointA_ARFCN=648840).</p>
<p>Reboot the Benetel.</p>
<h2 id="configure-the-rru-release-v04">Configure the RRU release V0.4<a class="headerlink" href="#configure-the-rru-release-v04" title="Permanent link">&para;</a></h2>
<h3 id="set-du-mac-address-in-the-rru">Set DU mac address in the RRU<a class="headerlink" href="#set-du-mac-address-in-the-rru" title="Permanent link">&para;</a></h3>
<p>Create this script to program the mac address of the DU inside the RRU. Remember the RRU does not request arp, so we have to manually configure that.</p>
<div class="highlight"><pre><span></span><code>root@benetelru:~# cat progDuMAC-5GCN-enp45s0f0 
# 11:22:33:44:55:66  5GCN-itf
registercontrol -w 0xC036B -x 0x88000088                            # don&#39;t touch file
eeprog_cp60 -f -x -16 /dev/i2c-0 0x57 -w 0x1A:0x01:0x11             # first byte of mac address is 0x11
eeprog_cp60 -f -x -16 /dev/i2c-0 0x57 -w 0x1B:0x01:0x22             # etc ...
eeprog_cp60 -f -x -16 /dev/i2c-0 0x57 -w 0x1C:0x01:0x33
eeprog_cp60 -f -x -16 /dev/i2c-0 0x57 -w 0x1D:0x01:0x44
eeprog_cp60 -f -x -16 /dev/i2c-0 0x57 -w 0x1E:0x01:0x55
eeprog_cp60 -f -x -16 /dev/i2c-0 0x57 -w 0x1F:0x01:0x66
</code></pre></div>
<h3 id="set-the-frequency-for-version-v04">Set the Frequency for version v0.4<a class="headerlink" href="#set-the-frequency-for-version-v04" title="Permanent link">&para;</a></h3>
<p>This file <code>/etc/systemd/system/multi-user.target.wants/autoconfig.service</code> is called during boot that sets the frequency.</p>
<div class="highlight"><pre><span></span><code>[Service]
ExecStart =/bin/sh /etc/radio_init.sh $(read_default_tx_frequency)
</code></pre></div>
<p>In this version the frequency is read from the eeprom. So we program the eeprom with the correct center frequency.
Programming the eeprom with the center frequency we do with this script.</p>
<div class="highlight"><pre><span></span><code>root@benetelru:~# cat progFreq

registercontrol -w 0xC036B -x 0x88000088                            # don&#39;t touch file
eeprog_cp60 -f -x -16 /dev/i2c-0 0x57 -w 0x174:0x01:0x33
eeprog_cp60 -f -x -16 /dev/i2c-0 0x57 -w 0x175:0x01:0x37
eeprog_cp60 -f -x -16 /dev/i2c-0 0x57 -w 0x176:0x01:0x35
eeprog_cp60 -f -x -16 /dev/i2c-0 0x57 -w 0x177:0x01:0x31
eeprog_cp60 -f -x -16 /dev/i2c-0 0x57 -w 0x178:0x01:0x2E
eeprog_cp60 -f -x -16 /dev/i2c-0 0x57 -w 0x179:0x01:0x36
eeprog_cp60 -f -x -16 /dev/i2c-0 0x57 -w 0x17A:0x01:0x38
eeprog_cp60 -f -x -16 /dev/i2c-0 0x57 -w 0x17B:0x01:0x30

eeprog_cp60 -f -x -16 /dev/i2c-0 0x57 -w 0x17C:0x01:0x33
eeprog_cp60 -f -x -16 /dev/i2c-0 0x57 -w 0x17D:0x01:0x37
eeprog_cp60 -f -x -16 /dev/i2c-0 0x57 -w 0x17E:0x01:0x35
eeprog_cp60 -f -x -16 /dev/i2c-0 0x57 -w 0x17F:0x01:0x31
eeprog_cp60 -f -x -16 /dev/i2c-0 0x57 -w 0x180:0x01:0x2E
eeprog_cp60 -f -x -16 /dev/i2c-0 0x57 -w 0x181:0x01:0x36
eeprog_cp60 -f -x -16 /dev/i2c-0 0x57 -w 0x182:0x01:0x38
eeprog_cp60 -f -x -16 /dev/i2c-0 0x57 -w 0x183:0x01:0x30

eeprog_cp60 -f -16 /dev/i2c-0 0x57 -r 0x174:8
eeprog_cp60 -f -16 /dev/i2c-0 0x57 -r 0x17C:8
</code></pre></div>
<p>Each byte 0x33,0x37,0x35, ... is the ascii value of a numbers 3751,680</p>
<h3 id="set-attenuation-level">Set attenuation level<a class="headerlink" href="#set-attenuation-level" title="Permanent link">&para;</a></h3>
<ol>
<li>read current attenuations
<div class="highlight"><pre><span></span><code>~# radiocontrol -o G a

Benetel radiocontrol Version          : 0.9.0
Madura API Version                    : 5.1.0.21
Madura ARM FW version                 : 5.0.0.32
Madura ARM DPD FW version             : 5.0.0.32
Madura Stream version                 : 8.0.0.5
Madura Product ID                     : 0x84
Madura Device Revision                : 0xb0
Tx1 Attenuation (mdB)                 : 20000
Tx2 Attenuation (mdB)                 : 40000
Tx3 Attenuation (mdB)                 : 21000
Tx4 Attenuation (mdB)                 : 40000
PLL1 Frequency (Hz)                   : 0 
PLL2 Frequency (Hz)                   : 3751680000 
Front-end Control                     : 0x2aa491
Madura Deframer 0                     : 0x87
Madura Framer 0                       : 0xa
Internal Temperature (degC)           : 47
External Temperature (degC)           : 42.789063
RX1 Power Level (dBFS)                : -60.750000
RX2 Power Level (dBFS)                : -60.750000
RX3 Power Level (dBFS)                : -60.750000
RX4 Power Level (dBFS)                : -60.750000
ORX1 Peak/Mean Power Level (dBFS)     : -10.839418/-22.709361
ORX2 Peak/Mean Power Level (dBFS)     : -inf/-inf
ORX3 Peak/Mean Power Level (dBFS)     : -10.748048/-21.656226
ORX4 Peak/Mean Power Level (dBFS)     : -inf/-inf
</code></pre></div></li>
<li>set attenuation for antenna 1
<div class="highlight"><pre><span></span><code>/usr/bin/radiocontrol -o A 20000 1
</code></pre></div></li>
<li>set attenuation for antenna 3
<div class="highlight"><pre><span></span><code>/usr/bin/radiocontrol -o A 21000 4
</code></pre></div><blockquote>
<p>yes the 4 at the end seems to be correct.</p>
</blockquote>
</li>
</ol>
<h2 id="configure-for-any-rru-release">Configure for any RRU release<a class="headerlink" href="#configure-for-any-rru-release" title="Permanent link">&para;</a></h2>
<h3 id="the-frequency-in-the-rru">The frequency in the RRU<a class="headerlink" href="#the-frequency-in-the-rru" title="Permanent link">&para;</a></h3>
<p>The frequency set in in the RRU is the center frequency. The center frequency has to be divisable by 3.84 Mhz.</p>
<p>Ths is an example of a configuration
* point A frequency : 3732.60  ( arfcn : 648840 ) - du configuration
* center Frequency  : 3751.68  ( arfcn : 650112 ) - rru configuration</p>
<p>3751.68 / 3.84 = 977 . It is divisable.</p>
<p>Some things you can check in the logging to see if everything is set correctly.
The same info in more detail can be found here
<a href="https://accelleran.atlassian.net/wiki/spaces/DB/pages/2003042324/Benetel+650#Frequency">Link setting frequency benetel650</a></p>
<div class="highlight"><pre><span></span><code>root@benetelru:~# radiocontrol -o G a
PLL2 Frequency (Hz)                   : 3751680000

cat du-config.json| grep -e bandwidth_mhz -e scs_khz  -e coreset_zero -e frequency_band -e arfcn -e nrb
                            &quot;nr_arfcn&quot;: 648840,          
                            &quot;frequency_band_list&quot;: [
                                    &quot;nr_frequency_band&quot;: 78
                        &quot;transmission_bandwidth&quot;: {
                            &quot;bandwidth_mhz&quot;: 40,
                            &quot;scs_khz&quot;: 30,
                            &quot;nrb&quot;: 106
                    &quot;coreset_zero_index&quot;: 3,


cat eff_log_bin | grep -i -e freq -e scs -e band
00001261908350886288 info add_coreset_zero: 0xff BWP{id=0, start_crb=0, num_rb=24, Scs::KHZ_30, CyclicPrefix::NORMAL}
00001261908350897548 info add_coreset_zero: 0x00 BWP{id=0, start_crb=0, num_rb=106, Scs::KHZ_30, CyclicPrefix::NORMAL}
00001261908387312201 info dlChannelBandwidth: 106
00001261908387312831 info ulChannelBandwidth_present: 0
00001261908387313431 info band: 78
00001261908387313991 info absoluteFrequencyPointA: 648840
00001261908387314601 info ulCenterFrequency_present: 0
00001261908387320821 info ssbConfig.absoluteFrequencySsb: 649152
00001261908387328381 info prachConfig.msg1_FrequencyStart: 0
</code></pre></div>
<h3 id="set-rru-mac-address-in-du-server">Set RRU mac address in DU server<a class="headerlink" href="#set-rru-mac-address-in-du-server" title="Permanent link">&para;</a></h3>
<h2 id="throubleshoot">Throubleshoot<a class="headerlink" href="#throubleshoot" title="Permanent link">&para;</a></h2>
<h3 id="gps">GPS<a class="headerlink" href="#gps" title="Permanent link">&para;</a></h3>
<p>See if GPS is locked
<div class="highlight"><pre><span></span><code>root@benetelru:~# syncmon
DPLL0 State (SyncE/Ethernet clock): LOCKED
DPLL1 State (FPGA clocks): FREERUN
DPLL2 State (FPGA clocks): FREERUN
DPLL3 State (RF/PTP clock): LOCKED

CLK0 SyncE LIVE: OK
CLK0 SyncE STICKY: LOS + No Activity
CLK2 10MHz LIVE: LOS + No Activity
CLK2 10MHz STICKY: LOS + No Activity
CLK5 GPS LIVE: OK
CLK5 GPS STICKY: LOS and Frequency Offset
CLK6 EXT 1PPS LIVE: LOS and Frequency Offset
CLK6 EXT 1PPS STICKY: LOS and Frequency Offset
</code></pre></div></p>
<h3 id="to-be-noted">To be noted<a class="headerlink" href="#to-be-noted" title="Permanent link">&para;</a></h3>
<p>some important registers
<div class="highlight"><pre><span></span><code>root@benetelru:~# reportRuStatus 

[INFO] Sync status is: 
Register 0xc0367, Value : 0x1
-------------------------------

[INFO] RU Status information is: 
Register 0xc0306, Value : 0x470800
-------------------------------

[INFO] Fill level of Reception Window is: 
Register 0xc0308, Value : 0x6c12
-------------------------------

[INFO] Sample Count is: 
Register 0xc0311, Value : 0x56f49
-------------------------------


============================================================
RU Status Register description:
============================================================
[31:19] not used                                                        
[18]    set to 1 if handshake is successful                             
[17]    set to 1 when settling time (fronthaul) has  completed 
[16]    set to 1 if symbolndex=0 was captured                           
[15]    set to 1 if payload format is invalid                           
[14]    set to 1 if symbol index error has been detected                
[13:12] not used                                                        
[11]    set to 1 if DU MAC address is correct                           
[10:2]  not used                                                        
[1]     Reception Window Buffer is empty                                
[0]     Reception Window Buffer is full                                 
------------------------------------------------------------
===========================================================
[NOTE] Max buffer  depth is 53424 (112 symbols, 2 antennas)
===========================================================
</code></pre></div></p>
<p>trace traffic between RRU and L1. Also the mac can be read from this trace. Packet lengths are 3874. 
Remember we increased the MTU size to 9000. Without increasing the L1 would crash on the fragmented udp packets.</p>
<div class="highlight"><pre><span></span><code>$ tcpdump -i enp45s0f0 -c 5 port 44000 -en
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on enp45s0f0, link-type EN10MB (Ethernet), capture size 262144 bytes
19:22:47.096453 02:00:5e:01:01:01 &gt; 6c:b3:11:08:a4:e0, ethertype IPv4 (0x0800), length 64: 10.10.0.2.44000 &gt; 10.10.0.1.44000: UDP, length 20
19:22:47.106677 6c:b3:11:08:a4:e0 &gt; 02:00:5e:01:01:01, ethertype IPv4 (0x0800), length 54: 10.10.0.1.44000 &gt; 10.10.0.2.44000: UDP, length 12
19:23:14.596247 02:00:5e:01:01:01 &gt; 6c:b3:11:08:a4:e0, ethertype IPv4 (0x0800), length 64: 10.10.0.2.44000 &gt; 10.10.0.1.44000: UDP, length 12
19:23:14.596621 6c:b3:11:08:a4:e0 &gt; 02:00:5e:01:01:01, ethertype IPv4 (0x0800), length 3874: 10.10.0.1.44000 &gt; 10.10.0.2.44000: UDP, length 3832
19:23:14.596631 6c:b3:11:08:a4:e0 &gt; 02:00:5e:01:01:01, ethertype IPv4 (0x0800), length 3874: 10.10.0.1.44000 &gt; 10.10.0.2.44000: UDP, length 3832
5 packets captured
</code></pre></div>
<p>Check if the L1 is listening 
<div class="highlight"><pre><span></span><code>$ while true ; do sleep 1 ; netstat -ano | grep 44000 ;echo $RANDOM; done
udp        0 118272 10.10.0.1:44000         0.0.0.0:*                           off (0.00/0/0)
1427
udp        0  16896 10.10.0.1:44000         0.0.0.0:*                           off (0.00/0/0)
11962
udp        0  42240 10.10.0.1:44000         0.0.0.0:*                           off (0.00/0/0)
16780
udp        0      0 10.10.0.1:44000         0.0.0.0:*                           off (0.00/0/0)
502
</code></pre></div></p>
<p>Show the traffic between rru and l1</p>
<div class="highlight"><pre><span></span><code>$ ifstat -i enp45s0f0
    enp45s0f0     
 KB/s in  KB/s out
71320.01  105959.7
71313.36  105930.1
</code></pre></div>
<h3 id="troubleshooting-fiber-port-not-showing-up">Troubleshooting Fiber Port not showing up<a class="headerlink" href="#troubleshooting-fiber-port-not-showing-up" title="Permanent link">&para;</a></h3>
<p>https://www.serveradminz.com/blog/unsupported-sfp-linux/</p>
<p>fiber port should always be like this
<div class="highlight"><pre><span></span><code>enp1s0f1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 9000
enp1s0f1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 9000
enp1s0f1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 9000
enp1s0f1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 9000
enp1s0f1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 9000
</code></pre></div></p>
<p>There should exist an arp entry like this
<div class="highlight"><pre><span></span><code>$ arp -an | grep 10.10
? (10.10.0.2) at 02:00:5e:01:01:01 [ether] PERM on enp1s0f1
</code></pre></div></p>
<h2 id="starting-rru-benetel-650">Starting RRU Benetel 650<a class="headerlink" href="#starting-rru-benetel-650" title="Permanent link">&para;</a></h2>
<p>Perform these steps to get a running active cell.</p>
<p>1) Start L1
2) Start DU<br />
   At this point following sequence is 
<div class="highlight"><pre><span></span><code>     DU                                        CU
      |  F1SetupRequest---&gt;                     |
      |                    &lt;---F1SetupResponse  |
      |                                 |
      |           &lt;---GNBCUConfigurationUpdate  |
      |                                         |
</code></pre></div>
   The L1 starts listening on ip:port 10.10.0.1:44000</p>
<p>3) type <code>ssh root@10.10.0.100  handshake</code>
   After less than 30 seconds communication between rru and du starts. around 100 Mbytes/second</p>
<div class="highlight"><pre><span></span><code>     DU                                        CU
      |  GNBCUConfigurationUpdateAck---&gt;        |
      |                                         |
</code></pre></div>
<p>5) type <code>ssh root@10.10.0.100 handshake</code> again to stop the traffic. ( If it does not stop use <code>ssh_rru "registercontrol -w c0310 -x 0</code> but be carefull )</p>
<h2 id="fiber-port-not-coming-up">Fiber port not coming up.<a class="headerlink" href="#fiber-port-not-coming-up" title="Permanent link">&para;</a></h2>
<p>It has been seen on a rare occasion that the B650 is not pingable although the interface is UP.
pinging the server has this result</p>
<div class="highlight"><pre><span></span><code>$ ping 10.10.0.100
PING 10.10.0.100 (10.10.0.100) 56(84) bytes of data.                   
From 10.10.0.1 icmp_seq=1 Destination Host Unreachable                 
From 10.10.0.1 icmp_seq=2 Destination Host Unreachable                 
From 10.10.0.1 icmp_seq=5 Destination Host Unreachable                            
</code></pre></div>
<div class="highlight"><pre><span></span><code>$ ip -br a
enp43s0f0        UP             10.10.0.1/24 fe80::21b:21ff:fec1:38a8/64  
</code></pre></div>
<p>in that case check the arp table</p>
<div class="highlight"><pre><span></span><code>$ arp -an
? (10.10.0.100) at &lt;incomplete&gt; on enp43s0f0   
</code></pre></div>
<p>powercycling the B650 a few times fixes this issue. Also I connect and reconnect the fiber SFP+ at the server side.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.expand", "navigation.top", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "toc.integrate"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.53c85856.min.js", "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.716f8af4.min.js"></script>
      
    
  </body>
</html>